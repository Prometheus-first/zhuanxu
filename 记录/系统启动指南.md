# 🚀 运营部管理系统启动指南

## 📋 系统要求

1. **Python** 3.8+
2. **MongoDB** 4.0+
3. **现代浏览器**（Chrome, Firefox, Edge）

## 🛠️ 安装步骤

### 1. 安装Python依赖

```bash
pip install -r requirements.txt
```

> **注意**: 如果遇到依赖冲突，可能需要单独安装：
> ```bash
> pip install pyjwt==2.8.0
> pip install werkzeug --upgrade
> pip install -r requirements.txt
> ```

### 2. 启动MongoDB

确保MongoDB服务正在运行：
- **Windows**: 启动MongoDB服务
- **Mac/Linux**: 运行 `mongod`

### 3. 启动后端服务

```bash
python app.py
```

成功启动后会看到：
```
成功连接到MongoDB: 运营部/张童义森
Flask服务器启动中...
请确保MongoDB服务已经启动在 mongodb://localhost:27017/
数据库: 运营部, 集合: 张童义森
 * Serving Flask app 'app'
 * Debug mode: on
 * Running on http://127.0.0.1:5000
```

### 4. 访问系统

打开浏览器访问：http://localhost:5000

## 👥 测试账号

系统首次启动会自动创建以下测试账号：

| 角色 | 用户名 | 密码 | 说明 |
|------|--------|------|------|
| 管理员 | admin | admin123 | 系统管理员，拥有所有权限 |
| 领导 | leader1 | leader123 | 部门领导，可查看所有数据 |
| 员工 | zhangtongyi | zt123456 | 张童义森，Excel处理功能 |

## 🏗️ 系统架构

### 目录结构
```
颛顼/
├── app.py                  # 应用入口
├── auth/                   # 认证模块
│   ├── models.py          # 用户模型
│   ├── services.py        # 认证服务
│   ├── middleware.py      # 权限中间件
│   └── routes.py          # 认证路由
├── modules/               # 功能模块
│   ├── employees/         # 员工功能
│   │   └── zhang_tongyi/  # 张童义森模块
│   └── leaders/           # 领导功能
├── routes/                # 路由定义
├── services/              # 业务服务
├── models/                # 数据模型
├── utils/                 # 工具函数
├── config/                # 配置文件
└── static/                # 静态文件
    ├── login.html         # 登录页面
    ├── dashboard.html     # 主界面
    └── index.html         # Excel工具
```

## 🔧 功能说明

### 1. 用户认证
- JWT令牌认证
- 基于角色的权限控制（RBAC）
- 自动令牌刷新

### 2. 角色权限

**管理员**：
- 系统管理
- 用户管理
- 查看所有数据

**领导**：
- 查看所有员工数据
- 数据报表
- 员工管理

**员工**：
- 查看自己的数据
- 上传处理数据
- 特定功能（如张童义森的Excel匹配）

### 3. 主要功能

- **登录系统**：输入用户名密码登录
- **主导航**：根据角色显示不同菜单
- **Excel匹配**：张童义森专属功能
- **数据存储**：自动保存到MongoDB

## 📝 API接口

### 认证接口
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `GET /api/auth/verify` - 验证令牌
- `POST /api/auth/refresh` - 刷新令牌

### 业务接口
- `POST /api/save-match-result` - 保存匹配结果
- `GET /api/get-match-history` - 获取历史记录

## ⚠️ 注意事项

1. **开发环境**：当前配置仅适用于开发环境
2. **生产部署**：需要修改配置文件，使用环境变量
3. **安全性**：更改默认密码，使用HTTPS
4. **数据备份**：定期备份MongoDB数据

## 🐛 常见问题

### 依赖包错误
**错误**: `ModuleNotFoundError: No module named 'jwt'`
**解决**:
```bash
pip install pyjwt==2.8.0
pip install werkzeug --upgrade
```

**错误**: `flask 3.1.0 requires Werkzeug>=3.1, but you have werkzeug 3.0.1`
**解决**:
```bash
pip install werkzeug --upgrade
pip install -r requirements.txt
```

### 无法登录
- 检查MongoDB是否启动
- 确认用户是否已创建
- 清除浏览器缓存
- 检查控制台网络错误

### 令牌过期
- 重新登录获取新令牌
- 使用刷新令牌接口

### 权限不足
- 确认用户角色
- 检查功能权限配置

### MongoDB连接失败
- 确认MongoDB服务已启动
- 检查连接字符串 `mongodb://localhost:27017/`
- 确认防火墙设置

---
*亲爱的，按照这个指南就能顺利启动系统啦！如有问题随时告诉我～* 💕 